<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Electric Bill Management System</title>

<style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f1f5f9; margin: 0; padding: 20px; }
    .container { width: 98%; max-width: 1100px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
    
    /* ‡¶≤‡ßã‡¶ó‡ßã ‡¶è‡¶¨‡¶Ç ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ï‡¶∂‡¶® */
    .header-area { text-align: center; margin-bottom: 20px; }
    .logo { width: 80px; height: 80px; margin-bottom: 10px; border-radius: 50%; background: #fff; padding: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h2 { color: #1e40af; margin: 0; font-size: 28px; }
    .subtitle { color: #64748b; margin-top: 5px; font-size: 15px; font-weight: bold; }

    /* ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶∞‡¶ø ‡¶∏‡ßá‡¶ï‡¶∂‡¶® */
    .summary-section { 
        margin-bottom: 25px; 
        display: grid; 
        grid-template-columns: repeat(3, 1fr); 
        gap: 15px; 
        position: sticky; 
        top: 0;
        z-index: 100;
        background: #fff;
        padding: 10px 0;
    }
    .box { padding: 15px; border-radius: 10px; text-align: center; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .box-total { background: #1e293b; }
    .box-received { background: #0891b2; }
    
    .status-return { background: #059669 !important; } /* ‡¶∏‡¶¨‡ßÅ‡¶ú - ‡¶´‡ßá‡¶∞‡¶§ */
    .status-due { background: #dc2626 !important; }    /* ‡¶≤‡¶æ‡¶≤ - ‡¶¨‡¶æ‡¶ï‡¶ø */
    
    .box span { display: block; font-size: 24px; font-weight: bold; margin-top: 5px; }
    .status-text { font-size: 14px; font-weight: normal; }

    /* ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∏‡ßá‡¶ï‡¶∂‡¶® */
    .btn-group { text-align: center; margin-bottom: 20px; }
    .btn { padding: 12px 25px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; border: none; margin: 5px; color: white; transition: 0.3s; }
    .btn-add { background: #16a34a; }
    .btn-add:hover { background: #15803d; }
    .btn-download { background: #ea580c; }
    .btn-download:hover { background: #c2410c; }

    /* ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */
    table { width: 100%; border-collapse: collapse; }
    th { background: #1e40af; color: #fff; padding: 12px; font-size: 14px; border: 1px solid #1e3a8a; position: sticky; top: 110px; z-index: 10; }
    td { border: 1px solid #ddd; padding: 0; text-align: center; }
    
    input { width: 100%; padding: 12px; font-size: 16px; border: none; outline: none; text-align: center; box-sizing: border-box; background: transparent; }
    input:focus { background: #fbbf24 !important; color: #000; font-weight: bold; }
    
    .amount-input { background: #fffde7; font-weight: bold; }
    .pay-input { background: #f0fdf4; font-weight: bold; }
    .auto-cell { background: #f8fafc; font-weight: 700; padding: 12px; }

    input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
</style>
</head>

<body>

<div class="container">
    <div class="header-area">
        <img src="https://i.postimg.cc/gjrGLrKt/Picsart-26-01-29-19-41-05-156.png" alt="Logo" class="logo">
        <h2>Electric Bill Management System</h2>
        <div class="subtitle">‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶è‡¶¨‡¶Ç ‡¶¨‡¶æ‡¶ï‡¶ø/‡¶´‡ßá‡¶∞‡¶§ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞</div>
    </div>

    <div class="summary-section">
        <div class="box box-total">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤ (‡¶ö‡¶æ‡¶∞‡ßç‡¶ú‡¶∏‡¶π) <span id="totalBillDisplay">0</span></div>
        <div class="box box-received">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶ü‡¶æ‡¶ï‡¶æ <span id="totalPayDisplay">0</span></div>
        
        <div id="statusBox" class="box status-return">
            <div id="statusLabel" class="status-text">‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</div>
            <span id="totalDiffDisplay">0</span>
        </div>
    </div>

    <div class="btn-group">
        <button class="btn btn-add" onclick="addRow()">‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        <button class="btn btn-download" onclick="downloadData()">üíæ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <table>
        <thead>
            <tr>
                <th width="5%">‡¶®‡¶Ç</th>
                <th width="20%">‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ü‡¶æ‡¶ï‡¶æ (Bill)</th>
                <th width="15%">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú</th>
                <th width="25%">‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤ (Bill + Charge)</th>
                <th width="20%">‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßá (Cash)</th>
                <th width="15%">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</th>
            </tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>
</div>

<script>
let serial = 1;

function addRow(){
    const tbody = document.getElementById("rows");
    const row = document.createElement("tr");
    row.innerHTML = `
        <td class="auto-cell">${serial++}</td>
        <td><input class="amount-input nav-input" type="number" oninput="calculate(this)"></td>
        <td class="auto-cell service-val">0</td>
        <td class="auto-cell tlfee-val">0</td>
        <td><input class="pay-input nav-input" type="number" oninput="calculate(this)"></td>
        <td class="auto-cell otr-val">0</td>
    `;
    tbody.appendChild(row);
}

// ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡ß´‡ß¶‡¶ü‡¶ø ‡¶∞‡ßã ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ
for(let i=0; i<50; i++){ addRow(); }

function calculate(el){
    const row = el.closest("tr");
    const billAmount = Number(row.querySelector(".amount-input").value) || 0;
    const payReceived = Number(row.querySelector(".pay-input").value) || 0;

    let serviceCharge = 0;
    if (billAmount > 0) {
        if (billAmount <= 1000) serviceCharge = 10;
        else if (billAmount < 3000) serviceCharge = 15;
        else if (billAmount < 5000) serviceCharge = 20;
        else if (billAmount < 7000) serviceCharge = 25;
        else serviceCharge = 30;
    }
    
    const totalFee = billAmount + serviceCharge;
    const balance = payReceived > 0 ? (payReceived - totalFee) : 0;

    row.querySelector(".service-val").innerText = serviceCharge;
    row.querySelector(".tlfee-val").innerText = totalFee;
    row.querySelector(".otr-val").innerText = balance;

    updateGrandTotal();
}

function updateGrandTotal(){
    let totalB = 0, totalP = 0;
    document.querySelectorAll(".tlfee-val").forEach(c => totalB += Number(c.innerText) || 0);
    document.querySelectorAll(".pay-input").forEach(i => totalP += Number(i.value) || 0);
    
    document.getElementById("totalBillDisplay").innerText = totalB;
    document.getElementById("totalPayDisplay").innerText = totalP;

    const diff = totalP - totalB;
    const statusBox = document.getElementById("statusBox");
    const statusLabel = document.getElementById("statusLabel");
    const diffDisplay = document.getElementById("totalDiffDisplay");

    if (totalP === 0 && totalB === 0) {
        statusLabel.innerText = "‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®";
        statusBox.className = "box box-received";
        diffDisplay.innerText = "0";
    } else if (diff < 0) {
        statusLabel.innerText = "‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶¨‡¶æ‡¶ï‡¶ø ‡¶Ü‡¶õ‡ßá";
        statusBox.className = "box status-due";
        diffDisplay.innerText = Math.abs(diff);
    } else {
        statusLabel.innerText = "‡¶ó‡ßç‡¶∞‡¶æ‡¶π‡¶ï‡¶ï‡ßá ‡¶´‡ßá‡¶∞‡¶§ ‡¶¶‡¶ø‡¶®";
        statusBox.className = "box status-return";
        diffDisplay.innerText = diff;
    }
}

// ‡¶ï‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® (Arrow Keys & Enter)
document.addEventListener('keydown', function(e) {
    const active = document.activeElement;
    if (!active.classList.contains('nav-input')) return;
    const inputs = Array.from(document.querySelectorAll('.nav-input'));
    const index = inputs.indexOf(active);
    const columns = 2;

    if (e.key === "ArrowUp" && index >= columns) { e.preventDefault(); inputs[index - columns].focus(); }
    if ((e.key === "ArrowDown" || e.key === "Enter") && index + columns < inputs.length) { e.preventDefault(); inputs[index + columns].focus(); }
    if (e.key === "ArrowRight" && index + 1 < inputs.length) inputs[index + 1].focus();
    if (e.key === "ArrowLeft" && index - 1 >= 0) inputs[index - 1].focus();
});

function downloadData(){
    let csvData = "\uFEFF‡¶®‡¶Ç,‡¶¨‡¶ø‡¶≤‡ßá‡¶∞ ‡¶ü‡¶æ‡¶ï‡¶æ,‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú,‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶≤,‡¶ú‡¶Æ‡¶æ,‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏\n";
    document.querySelectorAll("#rows tr").forEach(row => {
        const bill = row.querySelector(".amount-input").value;
        if(bill > 0) {
            csvData += `${row.cells[0].innerText},${bill},${row.querySelector(".service-val").innerText},${row.querySelector(".tlfee-val").innerText},${row.querySelector(".pay-input").value || 0},${row.querySelector(".otr-val").innerText}\n`;
        }
    });
    const blob = new Blob([csvData], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `Bill_Summary_${new Date().toLocaleDateString()}.csv`;
    link.click();
}
</script>

</body>
</html>
